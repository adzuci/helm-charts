language: generic
dist: bionic
sudo: false
env:
  global:
  - HELM_VERSION="v2.16.0"
install:
- sudo apt-get update
- sudo apt-get install -y yamllint
- wget http://storage.googleapis.com/kubernetes-helm/helm-${HELM_VERSION}-linux-amd64.tar.gz
  -O /tmp/helm.tar.gz
- tar xzf /tmp/helm.tar.gz -C /tmp --strip-components=1
- chmod +x /tmp/helm
before_script:
- "/tmp/helm init --client-only"
- "/tmp/helm repo add elastic https://helm.elastic.co"
script:
- |
  for chart in $(find . -name 'requirements.yaml'); do
    echo "=========== Begin $(dirname ${chart}) ==========="

    set -x
    /tmp/helm dep build $(dirname ${chart})
    /tmp/helm lint $(dirname ${chart})
    template=$(/tmp/helm template $(dirname ${chart}))
    set +x

    # See if the output is valid yaml
    echo $template | yamllint -d relaxed /dev/stdin

    echo "=========== End $(dirname ${chart}) ==========="
  done
deploy:
  provider: script
  script: bash .travis/deploy.sh
  on:
    branch: master
  env:
    secure: YPkIIKOilc0YzgB/RRB+vymrddO4fpOR6xjLMeNKF6dnk5N9twYOq96oCPST3GZ/KZBeEYDDYtyfL4zxXoeYbVv5PGppx8WMw8VqmvyPFukJIxSjpiew73tAfdu8M41TLT2TIFDRhE3SDDNdgpESNGgqWMgM6/DE4P5kym9fY0liqZPxNB9b8gCOsgxUqTXi0EqRjZbb/klAhAMBQGDV9IjqZJpLsqAGUoCJzGFhJgix1T9MBoni03PYA3sutVnZDAt+YAa1ChMZXLP6ZVIO4WkfwJ8mdTCjbwp5lCG20qLjekSVHluftcDYKQRtl0YJkWb9U1dLtj8RNfwPYpjJDwc+Dw9ji/7yR11IyocwXg2+C7grHFEX8WFjSlj4/I5GJqFdZS264Fl+q8I2t/bsb/5Y322wE4s8uSA5mQUT/DJtHh7CGtg5Ae4NRpYw76H3+AxjqAOio+BrOh+Cv+iW+OyMJEjyE2CIznYzYnA13CzKC8FKQydunZSTKti6tqRuO0wuNqDACrhoJJyKoaEr6bQk1AmZIkyDABP/xitU2cJPBZb+6afE32vH4NZ5dM0FexKV5gm1ZB/wVlHkTEN6JxLmYBnQwq5bdVPEfC6uC/mF8iLIw5RNeoqUdUnnzKYvxdWxsOVElCaRbCg4+RBKHsKiqguTMdXxe30RHPQA7WM=
